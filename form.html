<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>こいのまえ｜恋愛偏差値診断</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{--brand:#f88ca4;--bg:#fff8fb;--ink:#222;--muted:#f1eff4}
  *{box-sizing:border-box}
  body{margin:0;font-family:"Noto Sans JP",system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--ink)}
  header{position:sticky;top:0;background:var(--brand);color:#fff;padding:14px 16px;z-index:10}
  .bar{height:8px;background:rgba(255,255,255,.38);border-radius:999px;overflow:hidden;margin-top:6px}
  .bar>span{display:block;height:100%;width:0;background:#fff;transition:width .25s}
  main{max-width:760px;margin:0 auto;padding:18px 16px 96px}
  .card{background:#fff;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:18px}
  .qhead{font-size:1.05rem;font-weight:900;margin:4px 0 12px}
  .choices{display:grid;gap:10px}
  .choice{width:100%;border:2px solid var(--muted);background:#fafafa;border-radius:12px;padding:14px 16px;text-align:left;cursor:pointer;font-size:1rem}
  .choice[data-val="B"]{background:#eefcf7;border-color:#d8f2e9}
  .choice[data-val="C"]{background:#fbf9fe;border-color:#ebe7f3}
  .choice.selected{border-color:var(--brand);background:#fff}
  .nav{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #eee;padding:10px 14px;display:flex;gap:10px;justify-content:space-between}
  .btn{appearance:none;border:none;border-radius:999px;padding:14px 18px;font-size:1rem}
  .btn.secondary{background:#f3f3f3}
  .btn.primary{background:#f88ca4;color:#fff;opacity:.9}
  .btn.primary:disabled{opacity:.45}
  .hint{font-size:.9rem;color:#777;margin-top:10px}
</style>
</head>
<body>
<header>
  <div>恋愛偏差値 診断（全10問）</div>
  <div class="bar"><span id="fill"></span></div>
</header>

<main>
  <div class="card">
    <div class="qhead" id="qhead"></div>
    <div class="choices" id="choices"></div>
    <div class="hint">ショートカット：<kbd>1</kbd>/<kbd>2</kbd>/<kbd>3</kbd>で選択、<kbd>←</kbd>/<kbd>→</kbd>で前後</div>
  </div>
</main>

<div class="nav">
  <button class="btn secondary" id="prev">戻る</button>
  <div id="step" style="align-self:center;color:#666"></div>
  <button class="btn primary" id="next" disabled>次へ</button>
</div>

<script>
const Q = [
  {t:"Q1. 気になる人に対して、最初に浮かぶ感情は？",a:["A. 不安で少し距離を置く","B. 話しかけたい気持ちが勝る","C. 状況による/わからない"]},
  {t:"Q2. 恋愛で一番大事だと思うものは？",a:["A. 信頼と安心","B. ドキドキと高まり","C. まだ自分でもわからない"]},
  {t:"Q3. LINEの返信、どのくらい気にする？",a:["A. かなり気になる","B. あまり気にしない","C. 相手や状況による"]},
  {t:"Q4. デートに誘うとしたら？",a:["A. 準備して好みに合わせる","B. 思いついたら誘う","C. 勇気が出ないかも"]},
  {t:"Q5. 自分は恋愛に向いていると思う？",a:["A. 苦手意識がある","B. 割と向いている","C. わからない/経験が少ない"]},
  {t:"Q6. 好きな人ができたとき、まずするのは？",a:["A. 情報をじっくり調べる","B. すぐに接点を作る","C. 動き方が決められない"]},
  {t:"Q7. 理想の関係性は？",a:["A. じっくり信頼を築く","B. 刺激的で楽しい","C. 理想像がまだない"]},
  {t:"Q8. 好きな人に『好きな人いるの？』と聞かれたら？",a:["A. ごまかす/隠す","B. 伝える","C. 黙るかも"]},
  {t:"Q9. 恋愛での自分の強みは？",a:["A. 相手を察する力","B. 想いをまっすぐ伝える力","C. まだ分からない"]},
  {t:"Q10. これまでの恋愛経験をどう感じてる？",a:["A. 自信は低め","B. チャレンジはしてきた","C. 経験が少なく分からない"]},
];
const KEY="KOI_V3";
let i=0;
let ans = (JSON.parse(localStorage.getItem(KEY)||"null")?.answers)||Array(Q.length).fill("");

const elQ=document.getElementById('qhead');
const elC=document.getElementById('choices');
const elNext=document.getElementById('next');
const elPrev=document.getElementById('prev');
const elFill=document.getElementById('fill');
const elStep=document.getElementById('step');

function render(){
  const q=Q[i];
  elQ.textContent=q.t; elC.innerHTML="";
  ["A","B","C"].forEach((k,idx)=>{
    const b=document.createElement('button');
    b.type='button'; b.className='choice'; b.dataset.val=k;
    if(ans[i]===k) b.classList.add('selected');
    b.textContent=`${k}. ${q.a[idx]}`;
    b.onclick=()=>select(k);
    elC.appendChild(b);
  });
  elPrev.disabled=i===0;
  elNext.textContent=(i===Q.length-1)?"チャットへ進む":"次へ";
  elNext.disabled=!ans[i];
  elFill.style.width=`${(i/Q.length)*100}%`;
  elStep.textContent=`Q${i+1}/${Q.length}`;
}
function select(v){ ans[i]=v; save(); render(); }
function next(){ if(!ans[i]) return; if(i<Q.length-1){ i++; render(); } else { submit(); } }
function prev(){ if(i>0){ i--; render(); } }
function save(){ localStorage.setItem(KEY, JSON.stringify({answers:ans,index:i})); }

function submit(){
  // A=1 B=2 C=0 → 0-20 → 40-70
  let raw=0, c=0;
  ans.forEach(v=>{ if(v==="A") raw+=1; else if(v==="B") raw+=2; else c++; });
  const scaled = 40 + Math.round((raw/20)*30);
  const data = JSON.parse(localStorage.getItem(KEY)||"{}");
  localStorage.setItem(KEY, JSON.stringify({...data, answers:ans, quiz_raw:raw, quiz_scaled:scaled, cCount:c}));
  location.href="AIchat.html";
}

document.getElementById('next').addEventListener('click',next);
document.getElementById('prev').addEventListener('click',prev);
window.addEventListener('keydown',e=>{
  if(["1","2","3"].includes(e.key)){ select(["A","B","C"][Number(e.key)-1]); }
  if(e.key==="ArrowRight") next();
  if(e.key==="ArrowLeft") prev();
});
const saved=JSON.parse(localStorage.getItem(KEY)||"null");
if(saved?.index>=0) i=saved.index;
render();
</script>
</body>
</html>
